<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Healthimpro</title>

<style>
body{
  margin:0;
  background:#000;
  font-family:Arial,sans-serif;
  overflow:hidden;
}
#stage{
  position:relative;
  width:100vw;
  height:100vh;
}
video,canvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}
canvas{pointer-events:none}

#controls{
  position:fixed;
  bottom:16px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  padding:10px 14px;
  background:rgba(0,0,0,.7);
  border-radius:14px;
  z-index:10;
}
input,button{
  font-size:16px;
  padding:10px 14px;
  border-radius:10px;
  border:none;
}
button{
  background:#1f2937;
  color:#fff;
}

#preview{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  z-index:20;
}
#preview img{
  width:100%;
  height:100%;
  object-fit:contain;
}
#backBtn{
  position:absolute;
  top:20px;
  left:20px;
  padding:10px 14px;
  background:rgba(0,0,0,.7);
  color:#fff;
  border-radius:10px;
  font-size:16px;
}
</style>
</head>

<body>

<div id="stage">
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas"></canvas>
</div>

<div id="controls">
  <input id="heightCm" type="number" placeholder="Рост (см)">
  <button onclick="startCamera()">Камера</button>
  <button onclick="takePhoto()">Фото</button>
</div>

<div id="preview">
  <button id="backBtn" onclick="closePreview()">Назад</button>
  <img id="photoResult">
</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const heightInput = document.getElementById('heightCm');
const preview = document.getElementById('preview');
const photoResult = document.getElementById('photoResult');

let stream=null;

async function startCamera(){
  if(stream) stream.getTracks().forEach(t=>t.stop());

  stream = await navigator.mediaDevices.getUserMedia({
    video:true,
    audio:false
  });

  video.srcObject = stream;
  await video.play();

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
}

function takePhoto(){
  if(!video.videoWidth) return;

  const out=document.createElement('canvas');
  out.width=canvas.width;
  out.height=canvas.height;
  const octx=out.getContext('2d');

  octx.drawImage(video,0,0);
  octx.drawImage(canvas,0,0);

  photoResult.src = out.toDataURL('image/png');
  preview.style.display='block';
}

function closePreview(){
  preview.style.display='none';
}

function drawOverlay(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const h=parseInt(heightInput.value,10);
  if(!h) return;

  const cx=canvas.width/2;
  const step=(canvas.height/h)*10;

  // сетка
  ctx.strokeStyle='rgba(255,255,255,0.25)';
  ctx.lineWidth=1;
  for(let y=canvas.height;y>=0;y-=step){
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(canvas.width,y);
    ctx.stroke();
  }

  // ось
  ctx.strokeStyle='rgba(0,170,255,0.95)';
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.moveTo(cx,0);
  ctx.lineTo(cx,canvas.height);
  ctx.stroke();

  // брендинг
  ctx.fillStyle='#fff';
  ctx.font='700 24px Arial';
  ctx.fillText('ДОБРОБУТ', cx+12, 40);

  ctx.font='300 14px Arial';
  ctx.fillText('healthimpro.com', cx+12, canvas.height-20);
}

(function loop(){
  if(video.videoWidth) drawOverlay();
  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
